# ğŸ” CSIRO Biomass Competition - ì „ì²´ ë¶„ì„ ë¦¬í¬íŠ¸

## ğŸ“Š í˜„ì¬ ìƒí™© ìš”ì•½

| ëª¨ë¸ | CV | Public LB | Gap | íŠ¹ì§• |
|------|-----|-----------|-----|------|
| v27 (ì•™ìƒë¸”) | ~0.80 (í—ˆìœ„) | **0.70** | ~0.10 | Data leakage CV, 5ê°œ ëª¨ë¸ ì•™ìƒë¸” |
| CV1 (ë‹¨ë…) | 0.6366 | **0.68** | ~0.04 | ì •ì§í•œ CV, Date grouping |
| CV3 (ì „ì²˜ë¦¬) | 0.6508 | **0.65** | ~0.00 | ì´ë¯¸ì§€ ì „ì²˜ë¦¬ ì¶”ê°€ â†’ ì—­íš¨ê³¼ |
| **1ìœ„** | ? | **0.79** | - | Target |

---

## ğŸ”¬ í•µì‹¬ ì½”ë“œ ë¶„ì„

### v27 (Public LB 0.70) - Multi-Model Ensemble

```python
# v27ì˜ í•µì‹¬: 5ê°œ ë‹¤ë¥¸ ëª¨ë¸ ì•™ìƒë¸”
MODELS = {
    'v20': CSIROModelBase,      # ê¸°ë³¸ ëª¨ë¸, hidden_dim=512, layers=3
    'v22': CSIROModelV22,       # Frozen backbone, hidden_dim=256, layers=2
    'v23': CSIROModelBase,      # v20ê³¼ ë™ì¼ êµ¬ì¡°
    'v25': CSIROModelV25,       # VegIdx fusion ì¶”ê°€
    'v26': CSIROModelBase,      # v20ê³¼ ë™ì¼ êµ¬ì¡°
}

# í•´ìƒë„
img_size = (512, 512)

# ì•™ìƒë¸” ë°©ë²•
final_preds = simple_average(predictions)  # ë‹¨ìˆœ í‰ê· 
```

**v27ì˜ ê°•ì **:
1. **ëª¨ë¸ ë‹¤ì–‘ì„±**: 5ê°œ ë‹¤ë¥¸ ëª¨ë¸ êµ¬ì¡° ì•™ìƒë¸”
2. **Data Leakage CV**: CVê°€ í—ˆìœ„ë¡œ ë†’ì•˜ì§€ë§Œ, ì´ê²ƒì´ ì˜¤íˆë ¤ LBì—ì„œëŠ” ë„ì›€ë¨
3. **Multiple Augmentation Seeds**: ê° ë²„ì „ë§ˆë‹¤ ë‹¤ë¥¸ random seed

**v27ì˜ ì•½ì **:
1. TTA ë¯¸ì‚¬ìš©
2. ì•™ìƒë¸” ê°€ì¤‘ì¹˜ ìµœì í™” ì—†ìŒ (ë‹¨ìˆœ í‰ê· )
3. í•´ìƒë„ 512 (ë¹„ìµœì )

---

### CV1 (Public LB 0.68) - Single Model, Honest CV

```python
# CV1ì˜ í•µì‹¬: ì •ì§í•œ CV
img_size = (560, 560)  # ë” í° í•´ìƒë„

# Date-based grouping
groups = df['Sampling_Date']  # Data leakage ë°©ì§€

# ëª¨ë¸ êµ¬ì¡° (v20ê³¼ ë™ì¼)
hidden_dim = 512
num_layers = 3
dropout = 0.1
```

**CV1ì˜ ê°•ì **:
1. **ì •ì§í•œ CV**: CV-LB gapì´ ì‘ìŒ (~0.04)
2. **ë” í° í•´ìƒë„**: 560x560
3. **OOF ìˆ˜ì§‘**: ì•™ìƒë¸” ìµœì í™”ì— í™œìš© ê°€ëŠ¥

**CV1ì˜ ì•½ì **:
1. **ë‹¨ì¼ ëª¨ë¸**: v27ì€ 5ê°œ ëª¨ë¸ ì•™ìƒë¸”
2. **ë‹¨ì¼ Seed**: ë‹¤ì–‘ì„± ë¶€ì¡±

---

## ğŸ¯ Gap ë¶„ì„: ì™œ v27(0.70) > CV1(0.68)?

### í•µì‹¬ ë°œê²¬: **ì•™ìƒë¸” ë‹¤ì–‘ì„±**

| ìš”ì†Œ | v27 (0.70) | CV1 (0.68) | ì°¨ì´ |
|------|------------|------------|------|
| ëª¨ë¸ ìˆ˜ | 5ê°œ Ã— 5 fold = 25ê°œ | 1ê°œ Ã— 5 fold = 5ê°œ | **5ë°°** |
| ëª¨ë¸ êµ¬ì¡° | 3ê°€ì§€ (Base, V22, V25) | 1ê°€ì§€ | **3ë°°** |
| CV ì „ëµ | Data Leakage (ê³¼ì í•©) | Honest (ì¼ë°˜í™”) | - |
| í•´ìƒë„ | 512 | 560 | CV1 ìš°ìœ„ |

**ê²°ë¡ **: v27ì´ ë” ë†’ì€ ì´ìœ ëŠ” **ëª¨ë¸ ë‹¤ì–‘ì„±**ê³¼ **ì•™ìƒë¸” íš¨ê³¼**

---

## ğŸš€ 0.75 ë‹¬ì„± ì „ëµ

### Strategy 1: v27 ê°œì„  (ë¹ ë¥¸ ë°©ë²•)

v27 ê¸°ë°˜ìœ¼ë¡œ ê°œì„ í•˜ë©´ ê¸°ì¡´ 0.70ì„ ë¹ ë¥´ê²Œ ë„˜ì„ ìˆ˜ ìˆìŒ:

```python
# 1. TTA ì¶”ê°€ (ì˜ˆìƒ: +0.01~0.02)
def predict_with_tta(model, left, right):
    preds = []
    for hflip in [False, True]:
        for vflip in [False, True]:
            l = torch.flip(left, [3]) if hflip else left
            r = torch.flip(right, [3]) if hflip else right
            l = torch.flip(l, [2]) if vflip else l
            r = torch.flip(r, [2]) if vflip else r
            pred = model(l, r)
            preds.append(pred)
    return torch.stack(preds).mean(0)

# 2. WA State í›„ì²˜ë¦¬ (ì˜ˆìƒ: +0.005~0.01)
for idx, row in test_df.iterrows():
    if row['State'] == 'WA':
        preds[idx, 1] = 0.0  # Dry_Dead_g = 0

# 3. ì•™ìƒë¸” ê°€ì¤‘ì¹˜ ìµœì í™” (ì˜ˆìƒ: +0.01)
# OOF ê¸°ë°˜ Nelder-Mead ìµœì í™”
```

**ì˜ˆìƒ ê²°ê³¼**: 0.70 + 0.02 + 0.01 + 0.01 = **0.74**

---

### Strategy 2: CV1 ê¸°ë°˜ ë‹¤ì¤‘ ëª¨ë¸ (ì¤‘ê¸°)

CV1ì˜ ì •ì§í•œ CVë¥¼ ìœ ì§€í•˜ë©´ì„œ ë‹¤ì–‘ì„± ì¶”ê°€:

```python
# 1. Multi-seed ì•™ìƒë¸”
seeds = [42, 123, 456, 789, 999]
# ê° seedë¡œ 5-fold í•™ìŠµ â†’ 25ê°œ ëª¨ë¸

# 2. ë‹¤ë¥¸ Head êµ¬ì¡°
configs = [
    {'hidden_dim': 512, 'num_layers': 3, 'dropout': 0.1},  # Original
    {'hidden_dim': 256, 'num_layers': 2, 'dropout': 0.3},  # Small
    {'hidden_dim': 768, 'num_layers': 2, 'dropout': 0.2},  # Wide
]

# 3. ë‹¤ë¥¸ í•´ìƒë„
img_sizes = [(518, 518), (560, 560), (588, 588)]
```

**ì˜ˆìƒ ê²°ê³¼**: 0.68 Ã— ë‹¤ì–‘ì„± ë³´ë„ˆìŠ¤ = **0.72~0.74**

---

### Strategy 3: í•˜ì´ë¸Œë¦¬ë“œ (ìµœê³  ì ìˆ˜ ëª©í‘œ)

v27ê³¼ CV1ì„ ê²°í•©:

```python
# v27ì˜ ê¸°ì¡´ ëª¨ë¸ë“¤ (Data Leakage CV) + CV1 ëª¨ë¸ (Honest CV)
final_pred = 0.5 * v27_ensemble + 0.5 * cv1_ensemble

# OOF ê¸°ë°˜ ê°€ì¤‘ì¹˜ ìµœì í™”
# Note: v27ì€ OOFê°€ ì—†ìœ¼ë¯€ë¡œ, CV1 OOF ê¸°ë°˜ìœ¼ë¡œë§Œ ìµœì í™”
```

**ì˜ˆìƒ ê²°ê³¼**: **0.73~0.75**

---

### Strategy 4: External Data (ê³ ìœ„í—˜/ê³ ë³´ìƒ)

Irish Grass Clover ë°ì´í„°ì…‹ í™œìš©:

```
ì¥ì :
- ë” ë§ì€ í•™ìŠµ ë°ì´í„°
- ì¼ë°˜í™” ëŠ¥ë ¥ í–¥ìƒ

ë‹¨ì :
- ë„ë©”ì¸ ì°¨ì´ (Ireland vs Australia)
- êµ¬í˜„ ë³µì¡ë„ ë†’ìŒ
- íš¨ê³¼ ë¶ˆí™•ì‹¤
```

---

## ğŸ“ˆ ìš°ì„ ìˆœìœ„ ì‹¤í–‰ ê³„íš

### Phase 1: Quick Win (1-2ì¼)

**v27 + TTA + í›„ì²˜ë¦¬**

1. v27 inferenceì— TTA ì¶”ê°€
2. WA State Dead=0 í›„ì²˜ë¦¬
3. ì œì¶œ â†’ ëª©í‘œ: **0.72**

### Phase 2: Multi-seed (2-3ì¼)

**CV1 Ã— 3 seeds**

1. seed 42, 123, 456ìœ¼ë¡œ CV1 í•™ìŠµ
2. 3-seed ì•™ìƒë¸”
3. ì œì¶œ â†’ ëª©í‘œ: **0.71~0.72**

### Phase 3: Hybrid (3-4ì¼)

**v27 + CV1 ì•™ìƒë¸”**

1. v27 ì˜ˆì¸¡ + CV1 ì˜ˆì¸¡ ê²°í•©
2. ê°€ì¤‘ì¹˜ ìµœì í™” (CV1 OOF ê¸°ë°˜)
3. ì œì¶œ â†’ ëª©í‘œ: **0.73~0.75**

---

## ğŸ’¡ í•µì‹¬ ì¸ì‚¬ì´íŠ¸

### 1. Data Leakage CVì˜ ì—­ì„¤

- **CV1**: ì •ì§í•œ CV (0.6366) â†’ LB 0.68
- **v27**: Leakage CV (~0.80) â†’ LB 0.70

v27ì´ ë” ë†’ì€ ì´ìœ :
- Leakage CVë¡œ í•™ìŠµëœ ëª¨ë¸ì´ **train ë°ì´í„°ì— ë” ê³¼ì í•©**
- ê·¸ëŸ¬ë‚˜ **testì™€ trainì˜ ë¶„í¬ê°€ ë¹„ìŠ·**í•´ì„œ ê³¼ì í•©ì´ ì˜¤íˆë ¤ ë„ì›€ë¨
- ì´ê²ƒì€ Private LBì—ì„œ ì—­ì „ë  ìˆ˜ ìˆìŒ (ìœ„í—˜!)

### 2. ì•™ìƒë¸” ë‹¤ì–‘ì„±ì˜ í˜

```
ë‹¨ì¼ ëª¨ë¸ (CV1): LB 0.68
5-ëª¨ë¸ ì•™ìƒë¸” (v27): LB 0.70
ì°¨ì´: +0.02
```

â†’ **ë‹¤ì–‘ì„±ë§Œìœ¼ë¡œ +0.02 ê°œì„  ê°€ëŠ¥**

### 3. ì´ë¯¸ì§€ ì „ì²˜ë¦¬ì˜ ì—­ì„¤

- Discussionì—ì„œ +0.02 ë³´ê³  â†’ 0.60 ìˆ˜ì¤€ì—ì„œ íš¨ê³¼
- 0.70 ìˆ˜ì¤€ì—ì„œëŠ” ì˜¤íˆë ¤ ì—­íš¨ê³¼ (CV3: 0.65)

**ê²°ë¡ **: ê³ ë“ì ìì—ê²ŒëŠ” **ì¡ìŒ ì œê±°**ë³´ë‹¤ **ì •ë³´ ë³´ì¡´**ì´ ì¤‘ìš”

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

### Private LB ìœ„í—˜

```
Public: 53% ìƒ˜í”Œ
Private: 47% ìƒ˜í”Œ
```

- v27 (Leakage CV)ëŠ” Privateì—ì„œ í•˜ë½ ìœ„í—˜
- CV1 (Honest CV)ëŠ” Privateì—ì„œ ì•ˆì •ì 

### ì¶”ì²œ ì œì¶œ ì „ëµ

1. **Best Public**: v27 + TTA + í›„ì²˜ë¦¬ (ëª©í‘œ: 0.72~0.73)
2. **Safe Backup**: CV1 multi-seed (ëª©í‘œ: 0.71~0.72)

---

## ğŸ“‹ ë‹¤ìŒ ë‹¨ê³„

1. [ ] v27_tta_infer.py ì‘ì„± (TTA + WA í›„ì²˜ë¦¬)
2. [ ] v27 TTA ë²„ì „ ì œì¶œ
3. [ ] CV1 multi-seed í•™ìŠµ
4. [ ] í•˜ì´ë¸Œë¦¬ë“œ ì•™ìƒë¸” ì‹¤í—˜

---

*Created: 2026-01-23*
*Current Best: Public LB 0.70*
*Target: Public LB 0.75+*
